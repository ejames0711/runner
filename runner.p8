pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
	game={}
	game.state="play"

	plyr={}
	plyr.spr=1
	plyr.timer=0
	plyr.x=20
	plyr.y=85
	plyr.vy=0
	
	gravity=0.4
	
	ground={}
	ground.x=0
	ground.spd=3
	
	hill={} 
	hill.x=0
	hill.spd=2
	
	mnt={}
	mnt.x=0
	mnt.spd=1
	
	bckgrnd={ground,hill,mnt}
	
	lg_sb={}
	lg_sb.spr=43
	
	sb = {}
	sb.spr=6
	sb.timer=0
	sb.spd=2
	sb.x=90
	sb.y=85
	
	particles={}
	
 snowx={}
 snowy={}
 snowspd={}
 
 init_snow()
end

function _update()
	if game.state == "play" then
		play_game()
	elseif game.state == "end" then
		end_game()
	end
	
	spawn_particles()
	update_particles()
	update_snow()
end

function _draw()
	cls(1)
	draw_bckgrnd(68,1,mnt,5,16)
	draw_bckgrnd(50,2,hill,10,16)
	draw_bckgrnd(0,0,ground)
	spawn_snow()
	if game.state == "play" then
		spr(plyr.spr,plyr.x,plyr.y)
		spr(sb.spr,sb.x,sb.y)
		for p in all(particles) do
		circfill(p.x,p.y,p.r,p.c)
		end
	elseif game.state == "end" then
		print("game over",44,50,7)
	end

end
-->8
--animations

function anim_w_frames(object,init_spr,max_spr,frames)
	if object.timer < frames then
		object.timer+=1
	else
		if object.spr<max_spr then
			object.spr+=1
		else
			object.spr=init_spr
		end
		object.timer=0
	end
end

function anim_plyr()
	if plyr.st == "walk" then
		anim_w_frames(plyr,1,4,3)
	end
	
	if plyr.st == "jump" then
		if plyr.spr < 53 then plyr.spr = 53 end
		anim_w_frames(plyr,53,57,4)
	end
end

function anim_sb()
	sb.x-=sb.spd
	anim_w_frames(sb,6,8,5)
end

function anim_lg_sb()
	
end


--snow
function init_snow()
	for i=1,100 do
  add(snowx,flr(rnd(128)))
  add(snowy,flr(rnd(128)))
  add(snowspd,rnd(1.5)+0.5)
 end
end

function spawn_snow()
	for i=1,#snowx do
	 local scol=6
  
  if snowspd[i]<1 then
 	 scol=6
  elseif snowspd[i]<1.5 then
   scol=13
  end
  
  pset(snowx[i],snowy[i],scol)
 end
end

function update_snow()
  for i=1,#snowy do
	  local sy=snowy[i]
	  sy=sy+snowspd[i]
	  if sy>128 then
	   sy=sy-128
	  end
	  snowy[i]=sy
  end
end

function spawn_particles()
	local part_c={6,12,13}
	for i=1,3 do
		add(particles,{
			x=sb.x+rnd(8)+6,
			y=sb.y+rnd(8),
			r=1,
			c=rnd(part_c),
			l=1,
			speed=1+rnd(2)
		})
	end
	
end

function update_particles()
	for p in all(particles) do
		p.x+=p.speed
		p.y-=p.speed
		p.l-=1
		if p.l<0 then
			del(particles,p)
		end
		
	end
end



-->8
--helpers

function physics()
	plyr.vy+=gravity
	plyr.y+=plyr.vy
	
	if plyr.y>=85 then
			plyr.st = "walk"
			plyr.vy-=plyr.vy
			plyr.y=85
	end
	
	if plyr.y==85 then
		if btnp(❎) then
			plyr.st = "jump"
 		plyr.vy-=5
 		sfx(0)
		end
	end
end


function collision(a,b)
 local a_left=a.x
 local a_top=a.y
 local a_right=a.x+7
 local a_bottom=a.y+7
 
 local b_left=b.x
 local b_top=b.y
 local b_right=b.x+7
 local b_bottom=b.y+7

 if a_top>b_bottom then return false end
 if b_top>a_bottom then return false end
 if a_left>b_right then return false end
 if b_left>a_right then return false end
 
 return true 
end

function upd_bckgrnd(obj)
	obj.x-=obj.spd
	if obj.x<-127 then obj.x=0 end
end

function draw_bckgrnd(celx,cely,obj,sx,sy)
	map(celx,cely,obj.x,sx,sy)
	map(celx,cely,obj.x+128,sx,sy)
end


-->8
--state

function play_game()
	if collision(plyr,sb) then
		game.state="end"
	end
	physics()
	anim_plyr()
	anim_sb()
	
	for k,v in pairs(bckgrnd) do
		upd_bckgrnd(v)
	end
end

function end_game()
	plyr.spr = 0
	sb.spr = 0
end


__gfx__
00000000000000000000000000555500000000000000000000cccc0000cccc0000cccc00cc77cccccccc77777777cccc777cccc777777ccc77777777dddddddd
0000000005555550005555000566665000555500000000000cd777c00c7777c00c7777c0cccccccccccccccccccccccccccccccc7777cccd77777677dddddddd
000000005666666555666655566667655566665500000000cd77d77cc77d777cc777777cccccccccccdccccccccccccdcccccdcccc7cccdd77777777dddddddd
000000005666676556666765566667655666676500000000c7777d7cc7d7777cc777777cccccccddddddcccccccdddddccccdddcccccdddd77666777dddddddd
000000005666676556666765566666655666676500000000c777777cc777777cc7d7777cddddddddddddddddddddddddddddddddccccdddd76677777dddddddd
000000005666666556666665566666655666666500000000c777777ccd77777cc77d77dcdddddddddddddddddddddddddddddddddddddddd77777777dddddddd
0000000066566655566666656656665556666665000000000c7777c00cd777c00c777dc0dddddddddddddddddddddddddddddddddddddddd77777677dddddddd
00000000666506600556665066505660055666500000000000cccc0000cccc0000cccc00dddddddddddddddddddddddddddddddddddddddd77777777dddddddd
0000000550000000000000066000000000000007700000000000000077700000000000077777777777777777dccc7cddddddc77d7767777777777777c7777777
0000005555000000000000666600000000000077770000000000000077770000000007777777677777777777ddc77cddddddc7cd7777777777777777c7777777
0000055555500000000006666660000000000777777000007770007777777777000077777777677777777777ddc7ccdddddddccd7777767777777777dc777777
0000555555550000000066666666000000007767777700007777777777777777777777777777777777777777dddccddddddddcdd7777777777777777ddcc7777
0005555555555000000666666666600000077667767770005577777555577777777777557777777777777777dddccddddddddddd7767777777777777dddc7777
0055555555555500006666666666660000777777777777005555555555555555777555557667777777777777ddddcddddddddddd76677777ccc777ccddddcccc
0555555555555550066666666666666007777777777777705555555555555555555555557677777777777777dddddddddddddddd77777767dddcccdddddddddd
5555555555555555666666666666666677776777777767775555555555555555555555557777777777777777dddddddddddddddd77777777dddddddddddddddd
555555555555555566666666666666667777777700000000000000000000000000000000777777777777777700000cccccc0000000000cccccc0000000000000
5555555555555555666666666666666677777777000000000000000000000000000000007777777777777777000cc777777cc000000cc777777cc00000000000
555d5555555dd55566566566666656667667777700000000000000000000000000000000777777cc7777777700c77d7777777c0000c7777777777c0000000000
5555555555555d5566666656666566667766777700000000000000000000000000000000777777cd777777770c77dd777d7777c00c777777777777c000000000
5555555555555555666666666655666677777777000000000000000000000000000000007777ccdd777777770c7d77777dd777c00c777777777777c000000000
555555d55d55555566666666666666667777767700000000000000000000000000000000ccccdddd77777777c77777777777777cc77777777777777c00000000
555555555555555566666666666665567777677700000000000000000000000000000000dddddddd77777777c77777777777777cc77777777777777c00000000
555555555555555566666666666666667777777700000000000000000000000000000000dddddddd77777777c77777777777777cc77777777777777c00000000
5555555500000000666666660000000000000000005555000055555000005500005555000055550000000000c77777777777777cc77777777777777c00000000
5555555500000000666666660000000000000000056667500566666605556650056666500566665000000000c77777777777777cc77d77777777777c00000000
5555555500000000666666660000000000000000566667655776666656666665566666655666676500000000c77777777777777cc77dd7777777777c00000000
55555555000000006666666600000000000000005666666556666665566666655666666556666765000000000c777777777777c00c77dd77d77777c000000000
55555555000000006666666600000000000000005666666556666665566666655666666556666665000000000c777777777777c00c777777d77777c000000000
555555550000000066666666000000000000000056666665566666655676666566667765566666650000000000c7777777777c0000c7777777777c0000000000
5555555500000000666666660000000000000000055566660566665005766650666666505666655000000000000cc777777cc000000cc777777cc00000000000
555555550000000066666666000000000000000000005666005555000055550066555500066650000000000000000cccccc0000000000cccccc0000000000000
00000cccccc0000000000cccccc0000000000cccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000cc777777cc000000cc777777cc000000cc777777cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00c77d7777777c0000c7777777777c0000c77777ddd77c0000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c77dd777d7777c00c777777777777c00c77777777dd77c000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c7d77777dd777c00c777777777777c00c777777777d77c000000000000000000000000000000000000000000000000000000000000000000000000000000000
c77777777777777cc77777777777777cc77777777777777c00000000000000000000000000000000000000000000000000000000000000000000000000000000
c77777777777777cc77777777777777cc77777777777d77c00000000000000000000000000000000000000000000000000000000000000000000000000000000
c77777777777777cc77777777777dd7cc77777777777d77c00000000000000000000000000000000000000000000000000000000000000000000000000000000
c77777777777777cc777777777777d7cc77777777777777c00000000000000000000000000000000000000000000000000000000000000000000000000000000
c77777777777777cc77777777777777cc77777777777777c00000000000000000000000000000000000000000000000000000000000000000000000000000000
c77777777777777cc777777777dd777cc77777777777777c00000000000000000000000000000000000000000000000000000000000000000000000000000000
0c777777777777c00c777777ddd777c00c777777777777c000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c777777777777c00c777777d77777c00c777777777777c000000000000000000000000000000000000000000000000000000000000000000000000000000000
00c7777777777c0000c7777777777c0000c7777777777c0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000cc777777cc000000cc777777cc000000cc777777cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000cccccc0000000000cccccc0000000000cccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001415000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000141a0e150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000141500000000000000000000000000000000141a191a1a1500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001424191500001415000000000000000000001232323232323213000000000000000000001415141500001415000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000103030213011102130110000000000000000123232323232323232130000000000000000102020202011102020110000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010303030303030303030301100000000000012323232323232323232321300000000000010202020202020202020201100000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001030302030303030303030203011000000001232323232323232323232323213000000001020202020202020202020202011000000000000000000000000000000000000000000000000000000
2a2a2a2a242a2a2a1d2a2a2a2a2a2a1a1a192a2a2a2a2a2a2a2a2a1d2a2a2a2a2a1a0e2a2a2a2a0e2a2a2a2a2a2a2a2a0000103030303030302030303030303030110000123232323232323232323232323232130000102020202020202020202020202020110000000000000000000000000000000000000000000000000000
1d2a2a2a2a2a2a2a2a2a2a0e2a2a191a1a2a2a2a192a2a2a1d2a2a2a2a2a2a2a1d1a2a2a2a2a2a2a2a2a2a0e2a2a192a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a1a1a1a1a1a1a1a1a1a1a1a1a191a1a1a1a1a1a1a1a0e1a1a1a1a1a1a1a1a1a1a1a241a1a1a1a1a1a1a1a1a1a1a1a1a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2a2a2a2a2a2a2a192a2a2a2a2a2a2a1a1a2a1d2a2a2a2a2a2a2a2a2a2a2a2a2a2a1a2a2a2a2a2a192a2a2a2a2a2a2a2a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d1f1e2909090c0c1f29090c0c090b090d1f290b09090c0d0c1f1e290a0a0d090d1f1e2909090c0c1f29090c0c090b090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f1c0f0f0f0f0f0f0f1c0f0f0f0f0f0f0f0f0f0f0f0f0f1b0f0f0f0f1c0f0f0f0f0f0f0f0f0f0f0f0f0f0f1b0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f0f0f0f1b0f0f0f0f0f0f0f0f0f0f0f0f0f0f1c0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f1b0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
010100000f0500f0500f050100501005012050140501505017050190501b0501e050220502405025050270502a0502c0502e05031050340503605039050390503905000000000000000000000000000000000000
011000000c5430c5003c600246003c6150c54300500005000c5430c50000500005003c6150c54300500005000c5430c50000500005003c6150c54300500005000c5430c50000500005003c6150c5430050000500
__music__
00 01020304

